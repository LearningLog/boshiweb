(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a917778e"],{"07c8":function(e,t,n){"use strict";var s=n("1816"),a=n.n(s);a.a},1816:function(e,t,n){},"6de4":function(e,t,n){"use strict";n.d(t,"j",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"d",function(){return r}),n.d(t,"g",function(){return o}),n.d(t,"e",function(){return u}),n.d(t,"i",function(){return c}),n.d(t,"h",function(){return d}),n.d(t,"a",function(){return l}),n.d(t,"f",function(){return m}),n.d(t,"b",function(){return h}),n.d(t,"k",function(){return f});var s=n("b775");function a(e){return Object(s["a"])({url:"/system/roleV2/findRoleList",method:"post",data:e})}function i(e){return Object(s["a"])({url:"system/roleV2/getAllRole",method:"post",data:e})}function r(){return Object(s["a"])({url:"/system/customV2/getCustomManageList",method:"post",data:{}})}function o(e){return Object(s["a"])({url:"/system/roleV2/addrole",method:"post",data:e})}function u(e){return Object(s["a"])({url:"/system/roleV2/findRoleById",method:"post",data:e})}function c(e){return Object(s["a"])({url:"/system/roleV2/upateRole",method:"post",data:e})}function d(e){return Object(s["a"])({url:"/system/roleV2/deleterole",method:"post",data:e})}function l(e){return Object(s["a"])({url:"/system/roleV2/deleteMultiRole",method:"post",data:e})}function m(){return Object(s["a"])({url:"/system/roleV2/getDefaultManage",method:"post",data:{}})}function h(e){return Object(s["a"])({url:"/system/roleV2/findAllMenus",method:"post",data:e})}function f(e){return Object(s["a"])({url:"/system/roleV2/saveMenu",method:"post",data:e})}},a3db:function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"form-edit"},[n("el-form",{ref:"form",staticClass:"form",attrs:{model:e.form,"label-width":"120px"}},[n("el-form-item",{attrs:{label:"角色名称："}},[n("span",[e._v(e._s(e.form.rolename))])]),e._v(" "),n("el-form-item",{attrs:{label:"角色描述："}},[n("span",[e._v(e._s(e.form.desc))])]),e._v(" "),n("el-form-item",{attrs:{label:"角色类型：",prop:"roleGroupId"}},[n("el-radio-group",{model:{value:e.manageType,callback:function(t){e.manageType=t},expression:"manageType"}},e._l(e.manageTypeList,function(t){return n("el-radio",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.name))])}),1)],1),e._v(" "),n("el-form-item",{attrs:{label:"角色授权："}},[n("el-scrollbar",{attrs:{"wrap-class":"scrollbar-wrapper"}},[n("el-tree",{ref:"menuTree",attrs:{data:e.menuTree,"show-checkbox":"","default-expand-all":"","highlight-current":"","expand-on-click-node":!1,"check-on-click-node":!0,"node-key":"_id","default-checked-keys":e.treecheckedKeys,props:e.defaultProps},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,a=t.data;return n("span",{staticClass:"custom-tree-node"},[n("span",{attrs:{dataType:a.type}},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"permission"===a.type?"#iconzu":"#iconwenjianjia"}})]),e._v("\n              "+e._s(s.label)+"\n            ")])])}}])})],1)],1)],1),e._v(" "),n("div",{attrs:{id:"btnGroup"}},[n("el-button",{directives:[{name:"no-more-click",rawName:"v-no-more-click"}],attrs:{type:"primary"},on:{click:e.save}},[e._v("提交")]),e._v(" "),n("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.cancel("form")}}},[e._v("取消")])],1)],1)},a=[],i=(n("ac6a"),n("6de4")),r={data:function(){return{dataIsChange:0,noLeaveprompt:!1,id:"",form:{rolename:"",desc:"",manageType:1},manageType:1,manageTypeList:[],menuTree:[],treecheckedKeys:[],defaultProps:{children:"childs",label:"menuname",id:"_id"},menuids:[],permissionids:[]}},watch:{form:{handler:function(e){e&&this.dataIsChange++},deep:!0}},created:function(){this.id=this.$route.query.id,this.getInitData(),this.getManageType(),this.getAllMenus()},methods:{getInitData:function(){var e=this;Object(i["e"])({_id:this.id}).then(function(t){e.form=t.data.role,e.dataIsChange=-1})},getManageType:function(){var e=this;Object(i["f"])().then(function(t){e.manageTypeList=t.data})},getAllMenus:function(){var e=this;Object(i["b"])({_id:this.id}).then(function(t){e.getDefaultCheckedKeys(t.data),e.menuTree=t.data})},getDefaultCheckedKeys:function(e){var t=this;e.forEach(function(e){e.select&&t.treecheckedKeys.push(e._id),e.childs=e.childs||[],e.permissions=e.permissions||[],e.childs=e.childs.concat(e.permissions),e.childs.length&&t.getDefaultCheckedKeys(e.childs)})},getMenuidsAndPermissionids:function(e){var t=this;e.forEach(function(e){"permission"===e.type||e.ispush?e.ispush||(t.permissionids.push(e._id),e.ispush=!0):(t.menuids.push(e._id),e.ispush=!0),e.childs.length&&t.getMenuidsAndPermissionids(e.childs)})},save:function(){var e=this,t=this.$refs.menuTree.getCheckedNodes();this.getMenuidsAndPermissionids(t),console.log("menuids",this.menuids),console.log("permissionids",this.permissionids);var n={_id:this.id,manageType:this.manageType,menuids:this.menuids,permissionids:this.permissionids};Object(i["k"])(n).then(function(t){e.$message.success("角色授权成功！"),e.noLeaveprompt=!0,e.$router.push({path:"/systemManage/roleManage/list"})})},cancel:function(e){this.$router.push({path:"/systemManage/roleManage/list"})}},beforeRouteLeave:function(e,t,n){var s=this;this.dataIsChange&&!this.noLeaveprompt?setTimeout(function(){s.$confirm("您的数据尚未保存，是否离开？","离开页面",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){n()}).catch(function(){n(!1)})},200):n()}},o=r,u=(n("07c8"),n("2877")),c=Object(u["a"])(o,s,a,!1,null,"692bdf26",null);t["default"]=c.exports}}]);