(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-39ec5709"],{"0bd7":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"form-edit"},[n("el-form",{ref:"form",staticClass:"form",attrs:{model:e.form,rules:e.rules,"status-icon":!0,"label-width":"120px"}},[n("el-form-item",{staticClass:"required",attrs:{label:"权限名称",prop:"permissionname"}},[n("el-input",{attrs:{placeholder:"请输入权限名称",clearable:""},model:{value:e.form.permissionname,callback:function(t){e.$set(e.form,"permissionname",t)},expression:"form.permissionname"}})],1),e._v(" "),n("el-form-item",{staticClass:"required",attrs:{label:"权限标识",prop:"permissionmark"}},[n("el-input",{attrs:{placeholder:"请输入权限标识",clearable:""},model:{value:e.form.permissionmark,callback:function(t){e.$set(e.form,"permissionmark",t)},expression:"form.permissionmark"}})],1),e._v(" "),n("el-form-item",{staticClass:"required",attrs:{label:"权限code",prop:"permissioncode"}},[n("el-input",{attrs:{placeholder:"请输入权限code",clearable:""},model:{value:e.form.permissioncode,callback:function(t){e.$set(e.form,"permissioncode",t)},expression:"form.permissioncode"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"权限描述"}},[n("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入权限描述"},model:{value:e.form.permissiondesc,callback:function(t){e.$set(e.form,"permissiondesc",t)},expression:"form.permissiondesc"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"所属菜单",prop:"permissionbelongmenu2"}},[n("span",{staticClass:"pointer actcolor",on:{click:e.show_menu_tree_fn}},[e._v(e._s(e.menu_tip_txt))]),e._v(" "),n("el-input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],model:{value:e.form.permissionbelongmenu2,callback:function(t){e.$set(e.form,"permissionbelongmenu2",t)},expression:"form.permissionbelongmenu2"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"权限类别",prop:"permissionmanage"}},[n("el-radio-group",{model:{value:e.form.permissionmanage,callback:function(t){e.$set(e.form,"permissionmanage",t)},expression:"form.permissionmanage"}},e._l(e.manage_type,function(t){return n("el-radio",{key:t.permissionmanage,attrs:{label:t.permissionmanage}},[e._v(e._s(t.name))])}),1)],1)],1),e._v(" "),n("div",{attrs:{id:"btnGroup"}},[n("el-button",{directives:[{name:"no-more-click",rawName:"v-no-more-click"}],attrs:{type:"primary"},on:{click:function(t){return e.save("form")}}},[e._v("保存")]),e._v(" "),n("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return e.cancel("form")}}},[e._v("取消")])],1),e._v(" "),n("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{title:"所属菜单",visible:e.menu_tree_flag,width:"50%"},on:{"update:visible":function(t){e.menu_tree_flag=t}}},[n("div",{staticClass:"menu_tree_box"},[n("el-scrollbar",{attrs:{"wrap-class":"scrollbar-wrapper"}},[n("el-tree",{ref:"tree",attrs:{data:e.treeData,props:e.defaultProps,"show-checkbox":"","node-key":"id","check-strictly":!0,"expand-on-click-node":!1,"check-on-click-node":!0,"default-expand-all":"","highlight-current":""},on:{"check-change":e.menu_tree_check_fn}})],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:e.save_menu}},[e._v("确认")]),e._v(" "),n("el-button",{attrs:{type:"primary",plain:""},on:{click:e.cancel_menu}},[e._v("取消")])],1)])],1)},i=[],s=(n("28a5"),n("ac6a"),n("55dd"),n("ea8f")),o=n("a888"),a={directives:{elDragDialog:o["a"]},data:function(){return{dataIsChange:0,noLeaveprompt:!1,form:{permissionname:"",permissionmark:"",permissioncode:"",permissiondesc:"",permissionbelongmenu:[],permissionmanage:"",permissionbelongmenu2:"111"},menu_dt:[],treeData:[],menu_tip_txt:"请选择菜单",menu_tree_flag:!1,menu_tree_checked:{ids:[],checkey:[],dt:{},lables:[]},manage_type:[],defaultProps:{children:"children",label:"label"},query_param:"",rules:{permissionname:[{required:!0,message:"请输入权限名称（长度在 1 到 64 个字符）",trigger:"blur"},{required:!0,message:"请输入权限名称（长度在 1 到 64 个字符）",trigger:"change"},{min:1,max:64,message:"长度在 1 到 64 个字符",trigger:"blur"},{min:1,max:64,message:"长度在 1 到 64 个字符",trigger:"change"}],permissionmark:[{required:!0,message:"请输入权限标识（长度在 1 到 64 个字符）",trigger:"blur"},{required:!0,message:"请输入权限标识（长度在 1 到 64 个字符）",trigger:"change"},{min:1,max:64,message:"长度在 1 到 64 个字符",trigger:"blur"},{min:1,max:64,message:"长度在 1 到 64 个字符",trigger:"change"}],permissioncode:[{required:!0,message:"请输入权限code（长度在 1 到 64 个字符）",trigger:"blur"},{required:!0,message:"请输入权限code（长度在 1 到 64 个字符）",trigger:"change"},{min:1,max:64,message:"长度在 1 到 64 个字符",trigger:"blur"},{min:1,max:64,message:"长度在 1 到 64 个字符",trigger:"change"}],permissionbelongmenu2:[{required:!0,message:"请选择所属菜单",trigger:"blur"},{required:!0,message:"请选择所属菜单",trigger:"change"}],permissionmanage:[{required:!0,message:"请选择权限类别",trigger:"change"}]}}},watch:{form:{handler:function(e){e&&this.dataIsChange++},deep:!0}},created:function(){this.query_param=this.$route.query.ids,this.get_menu(),this.get_permission_manage_type(),this.get_det()},methods:{get_menu:function(){var e=this,t={};Object(s["g"])(t).then(function(t){var n=t.data.MenuV2List;e.menu_dt=e.translate(n),e.treeData=e.menu_dt[0]})},get_permission_manage_type:function(){var e=this,t={};Object(s["f"])(t).then(function(t){e.manage_type=t.data})},translate:function(e){if(!(e&&e.length>0))return[];var t={},n=[],r={},i={},s=[];s.push(n);for(var o=function(e){if(e in i)return i[e];var t=[];return i[e]=t,s.push(t),i[e]},a=0;a<e.length;a++){var m=e[a],c={},u=m["_id"],l=o(m.cid);c["label"]=m["menuname"],c["children"]=l,c["orders"]=m["orders"],c["id"]=m["_id"],t[u]=c;var d=m.pid;if("firstMenu"===d)n.push(c);else{var f=o(d);f.push(c)}r[m.cid]=c}for(var p=function(e,t){return e.orders-t.orders},h=0;h<s.length;h++){var g=s[h];g.sort(p)}var _={},b=function e(n,r){if(n&&n.length>0)for(var i=0;i<n.length;i++){var s=n[i],o=s.id,a=[];if(r&&r.length>0)for(var m=0;m<r.length;m++){var c=r[0],u=t[c];a.push({id:c,label:u.label})}a.push({id:o,label:s.label}),_[o]=a;var l=s.children;if(l&&l.length>0){var d=r.concat();d.push(o),e(l,d)}}};return b(n,[]),[n,_]},show_menu_tree_fn:function(){var e=this;this.menu_tree_flag=!0;var t=this.menu_tree_checked.ids;if(0!==t.length){var n=t[t.length-1];this.$nextTick(function(){e.$refs.tree.setCheckedKeys([n])})}},menu_tree_check_fn:function(e,t,n){if(this.menu_tree_checked.checkey=[e.id],!0===t){var r=[],i=[],s=e.id,o=this.menu_dt[1],a=o[s];a.forEach(function(e){r.push(e.id),i.push(e.label)}),this.menu_tree_checked.ids=r,this.menu_tree_checked.lables=i,this.$refs.tree.setCheckedKeys([e.id]),this.menu_tree_checked.dt=e}else this.menu_tree_checked.id===e.id&&this.$refs.tree.setCheckedKeys([e.id])},save_menu:function(){var e=this.menu_tree_checked.lables,t="";e.forEach(function(e){t+=e+"/"}),this.menu_tip_txt=t.substring(0,t.length-1),this.form.permissionbelongmenu=this.menu_tree_checked.ids,this.form.permissionbelongmenu2=this.form.permissionbelongmenu.length?"11111":"",this.menu_tree_flag=!1},cancel_menu:function(){this.menu_tree_flag=!1,this.menu_tree_checked.ids===[]&&(this.$refs.tree.setCheckedKeys([]),this.menu_tree_checked={ids:[],checkey:[],dt:{},lables:[]},this.menu_tip_txt="请选择菜单")},get_det:function(){var e=this,t=this,n={};n._id=this.query_param,Object(s["c"])(n).then(function(n){var r=n.data.permission;t.form.modulename=r.modulename,t.form.permissionname=r.permissionname,t.form.permissionmark=r.permissionmark,t.form.permissioncode=r.permissioncode,t.form.permissiondesc=r.permissiondesc,t.form.permissionmanage=r.permissionmanage,t.form.permissionbelongmenu=r.permissionbelongmenu,t.menu_tip_txt=r.permissionbelongmenuname,e.menu_tree_checked.ids=r.permissionbelongmenu;var i=r.permissionbelongmenuname,s=i.split("/");e.menu_tree_checked.lables=s,e.dataIsChange=-1}).catch(function(e){console.log(e)})},save:function(e){var t=this,n=this.query_param;this.$refs[e].validate(function(e){e&&(t.form._id=t.query_param,Object(s["d"])(t.form).then(function(e){t.$message.success("修改权限成功！"),t.noLeaveprompt=!0,t.$router.push({path:"/systemManage/permissionManage/detail",query:{ids:n}})}))})},cancel:function(e){this.$router.push({path:"/systemManage/permissionManage/list"})}},beforeRouteLeave:function(e,t,n){var r=this;this.dataIsChange&&!this.noLeaveprompt?setTimeout(function(){r.$confirm("您的数据尚未保存，是否离开？","离开页面",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){n()}).catch(function(){n(!1)})},200):n()}},m=a,c=(n("fd0a"),n("2877")),u=Object(c["a"])(m,r,i,!1,null,"450fcc91",null);t["default"]=u.exports},a888:function(e,t,n){"use strict";n("a481"),n("6762"),n("2fdb");var r={bind:function(e,t,n){var r=e.querySelector(".el-dialog__header"),i=e.querySelector(".el-dialog");r.style.cssText+=";cursor:move;",i.style.cssText+=";top:0px;";var s=function(){return window.document.currentStyle?function(e,t){return e.currentStyle[t]}:function(e,t){return getComputedStyle(e,!1)[t]}}();r.onmousedown=function(e){var t=e.clientX-r.offsetLeft,o=e.clientY-r.offsetTop,a=i.offsetWidth,m=i.offsetHeight,c=document.body.clientWidth,u=document.body.clientHeight,l=i.offsetLeft,d=c-i.offsetLeft-a,f=i.offsetTop,p=u-i.offsetTop-m,h=s(i,"left"),g=s(i,"top");h.includes("%")?(h=+document.body.clientWidth*(+h.replace(/\%/g,"")/100),g=+document.body.clientHeight*(+g.replace(/\%/g,"")/100)):(h=+h.replace(/\px/g,""),g=+g.replace(/\px/g,"")),document.onmousemove=function(e){var r=e.clientX-t,s=e.clientY-o;-r>l?r=-l:r>d&&(r=d),-s>f?s=-f:s>p&&(s=p),i.style.cssText+=";left:".concat(r+h,"px;top:").concat(s+g,"px;"),n.child.$emit("dragDialog")},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null}}}},i=function(e){e.directive("el-drag-dialog",r)};window.Vue&&(window["el-drag-dialog"]=r,Vue.use(i)),r.install=i;t["a"]=r},bcee:function(e,t,n){},ea8f:function(e,t,n){"use strict";n.d(t,"e",function(){return i}),n.d(t,"g",function(){return s}),n.d(t,"f",function(){return o}),n.d(t,"a",function(){return a}),n.d(t,"d",function(){return m}),n.d(t,"b",function(){return c}),n.d(t,"c",function(){return u});var r=n("b775");function i(e){return Object(r["a"])({url:"/system/permissionV2/findPermissionList",method:"post",data:e})}function s(e){return Object(r["a"])({url:"/system/menuV2/findAllMenus",method:"post",data:e})}function o(e){return Object(r["a"])({url:"/system/permissionV2/getDefaultManage",method:"post",data:e})}function a(e){return Object(r["a"])({url:"/system/permissionV2/addPermissionInfo",method:"post",data:e})}function m(e){return Object(r["a"])({url:"/system/permissionV2/updatePermissionInfo",method:"post",data:e})}function c(e){return Object(r["a"])({url:"/system/permissionV2/deletePermissionInfo",method:"post",data:e})}function u(e){return Object(r["a"])({url:"/system/permissionV2/findPermissionById",method:"post",data:e})}},fd0a:function(e,t,n){"use strict";var r=n("bcee"),i=n.n(r);i.a}}]);