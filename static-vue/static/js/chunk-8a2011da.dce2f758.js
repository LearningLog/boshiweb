(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8a2011da"],{"0854":function(e,t,a){"use strict";var i=a("ec9b"),n=a.n(i);n.a},"0f1e":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("div",{attrs:{id:"filePicker"}},[e._v("选择文件")]),e._v(" "),a("div",{staticClass:"file-panel"},[a("h2",[e._v("文件列表")]),e._v(" "),a("div",{staticClass:"file-list"},[e._l(e.fileList,function(t){return a("ul",{key:t.id,staticClass:"file-item",class:"file-"+t.id},[a("li",{staticClass:"file-type",attrs:{icon:e.fileCategory(t.ext)}}),e._v(" "),a("li",{staticClass:"file-name"},[e._v(e._s(t.name))]),e._v(" "),a("li",{staticClass:"file-size"},[e._v(e._s(e.fileSize(t.size)))]),e._v(" "),a("li",{staticClass:"file-status"},[e._v("上传中...")]),e._v(" "),a("li",{staticClass:"file-operate"},[a("a",{attrs:{title:"开始"},on:{click:function(a){return e.resume(t)}}},[a("i",{staticClass:"iconfont iconkaishi"})]),e._v(" "),a("a",{attrs:{title:"暂停"},on:{click:function(a){return e.stop(t)}}},[a("i",{staticClass:"iconfont iconzanting1"})]),e._v(" "),a("a",{attrs:{title:"移除"},on:{click:function(a){return e.remove(t)}}},[a("i",{staticClass:"iconfont iconquxiao1"})])]),e._v(" "),a("li",{staticClass:"progress"})])}),e._v(" "),e.fileList.length?e._e():a("div",{staticClass:"no-file"},[a("i",{staticClass:"iconfont icon-empty-file"}),e._v(" 暂无待上传文件")])],2)]),e._v(" "),a("vue-webuploader",{ref:"uploader",attrs:{"upload-button":"#filePicker",multiple:"","form-data":e.formData,url:e.url},on:{fileChange:e.fileChange,progress:e.onProgress,success:e.onSuccess}})],1)},n=[],o=(a("456d"),a("20d6"),a("7f7f"),a("28a5"),a("ac6a"),a("5df3"),a("f400"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"upload"})}),l=[],s=(a("55dd"),a("c5f6"),a("c0d7")),r=a("b383"),c=window.$,u={name:"VueWebuploader",props:{accept:{type:Object,default:null},url:{type:String,default:""},fileSizeLimit:{type:Number,default:107374182400},fileNumLimit:{type:Number,default:100},fileSingleSizeLimit:{type:Number,default:107374182400},formData:{type:Object,default:null},keyGenerator:{type:Function,default:function(e){var t=(new Date).getTime(),a="".concat(t,".").concat(e.name);return a}},multiple:{type:Boolean,default:!1},uploadButton:{type:String,default:""},uploadDndButton:{type:String,default:""}},data:function(){return{uploader:null,publicOption:{},uploadContCommon:{onUploadFileErr:null,onUploadFileSuccess:null,callbackDate:null},chunkSize:5242880,fileMd5MarkMap:new Map,uniqueFileNameMap:new Map}},mounted:function(){this.initWebUpload()},methods:{initWebUpload:function(){var e=this,t=this;new WebUploader.Uploader.register({"before-send-file":"beforeSendFile","before-send":"beforeSend","after-send-file":"afterSendFile"},{beforeSend:function(e){var a=new c.Deferred,i=e.file,n=i.id;return t.uploader.md5File(i,e.start,e.end).then(function(i){var o={status:"chunkCheck",name:t.uniqueFileNameMap.get(n),chunkIndex:e.chunk,size:e.end-e.start,userId:t.formData.userId,companyId:t.formData.companyId,appCode:t.formData.appCode,blockmd5:i};Object(s["b"])(r.stringify(o),t.url).then(function(e){var t=e.data;1===t.ifExist?a.reject():a.resolve()},function(e,t,i){a.reject()})}),c.when(a)},afterSendFile:function(e){var a=Math.ceil(e.size/t.chunkSize),i=new c.Deferred,n={status:"chunksMerge",name:t.uniqueFileNameMap.get(e.id),chunks:a,ext:e.ext,md5:t.fileMd5MarkMap.get(e.id),userId:t.formData.userId,companyId:t.formData.companyId,appCode:t.formData.appCode};return Object(s["b"])(r.stringify(n),t.url).then(function(a){var n=a.data;e.path=n.path,i.resolve(),t.uniqueFileNameMap.remove(e.id),t.fileMd5MarkMap.remove(e.id)}).catch(function(e){console.info(e)}),c.when(i)}}),this.uploader=WebUploader.create({auto:!0,swf:"/public/webUploader/js/Uploader.swf",server:this.url+"fileUpload",pick:{id:this.uploadButton,multiple:this.multiple,label:""},dnd:this.uploadDndButton,disableWidgets:"log",paste:document.body,disableGlobalDnd:!0,thumb:{width:100,height:100,quality:100,allowMagnify:!1,crop:!0},compress:!1,prepareNextFile:!0,chunked:!0,chunkSize:this.chunkSize,threads:5,formData:this.formData,fileSizeLimit:this.fileSizeLimit,fileSingleSizeLimit:this.fileSingleSizeLimit,fileNumLimit:this.fileNumLimit,resize:!1,accept:this.getAccept(this.accept),duplicate:!0}),this.uploader.on("fileQueued",function(t){var a=e;t.onUploadFileErr=a.uploadContCommon.onUploadFileErr,t.onUploadFileSuccess=a.uploadContCommon.onUploadFileSuccess,t.callbackDate=a.uploadContCommon.callbackDate,a.uploader.sort(function(e,t){return e.size-t.size});var i=md5(t.name+t.size+t.type+a.formData.userId);a.uniqueFileNameMap.set(t.id,i),a.uploader.makeThumb(t,function(e,t){e?console.log("预览错误，上传的不是图片吧？"):console.log("预览成功 base64")}),a.$emit("fileChange",t)}),this.uploader.on("uploadStart",function(e){}),this.uploader.on("uploadProgress",function(t,a){e.$emit("progress",t,a)}),this.uploader.on("uploadSuccess",function(t,a){e.$emit("success",t,a)}),this.uploader.on("uploadError",function(t,a){console.error(a),e.$emit("uploadError",t,a)}),this.uploader.on("error",function(t){var a="";a="F_EXCEED_SIZE"===t?"文件大小不能超过".concat(e.fileSingleSizeLimit/1024e3,"M"):"Q_EXCEED_NUM_LIMIT"===t?"文件上传已达到最大上限数":"上传出错！请检查后重新上传！错误代码".concat(t),console.error(a),e.$emit("error",a)}),this.uploader.on("uploadComplete",function(t,a){console.log("uploadComplete"),e.$emit("complete",t,a)})},upload:function(e){this.uploader.upload(e)},stop:function(e){this.uploader.stop(e)},cancelFile:function(e){this.uploader.cancelFile(e)},removeFile:function(e,t){this.uploader.removeFile(e,t)},getAccept:function(e){switch(e){case"text":return{title:"Texts",exteensions:"doc,docx,xls,xlsx,ppt,pptx,pdf,txt",mimeTypes:".doc,docx,.xls,.xlsx,.ppt,.pptx,.pdf,.txt"};case"video":return{title:"Videos",exteensions:"mp4",mimeTypes:".mp4"};case"image":return{title:"Images",exteensions:"gif,jpg,jpeg,bmp,png",mimeTypes:".gif,.jpg,.jpeg,.bmp,.png"};default:return e}}}},d=u,p=(a("f725"),a("2877")),f=Object(p["a"])(d,o,l,!1,null,null,null),m=f.exports,h=window.$,b={name:"FileUploader",components:{VueWebuploader:m},props:{belongs:{type:Object,default:null}},data:function(){return{fileList:[],url:this.$store.state.user.applicationInfo.uploadUrl,formData:{userId:this.$store.state.user.applicationInfo.userId,companyId:this.$store.state.user.applicationInfo.companyId,appCode:this.$store.state.user.applicationInfo.appCode},fileQueued:new Map}},computed:{uploader:function(){return this.$refs.uploader}},watch:{},mounted:function(){},created:function(){},methods:{fileChange:function(e){if(e.size){this.fileList.push(e),console.log(e);var t=e.source.uid,a={data_type:this.belongs.data_type,ownerId:this.belongs.ownerId,parentId:this.belongs.parentId,selectCompanyId:this.belongs.selectCompanyId};this.fileQueued.set(t,a),console.log("fileChange",e)}},onProgress:function(e,t){h(".file-".concat(e.id," .progress")).css("width",100*t+"%"),h(".file-".concat(e.id," .file-status")).html((100*t).toFixed(2)+"%")},onSuccess:function(e,t){var a=this;console.log("上传成功",e),console.log(this.belongs),console.log("file.path",e.path),e.path=e.path||"";var i=e.path.split("ZmlsZUlk=")[1],n=e.source.uid;if(3===this.belongs.data_type){var o={fileFormat:e.ext,fileName:e.name,fileSize:e.size,fileUrl:e.path,resourceFileId:i};Object(s["a"])(o).then(function(e){console.log(e),a.$message.success("工作台文件上传成功")})}else{var l=this.fileQueued.get(n),r={format:e.ext,name:e.name,size:e.size,url:e.path,data_type:l.data_type,ownerId:l.ownerId,parentId:l.parentId,selectCompanyId:l.selectCompanyId,fileId:i};Object(s["c"])(r).then(function(e){console.log(e),1===l.data_type?a.$message.success("企业知识库文件上传成功"):a.$message.success("小组知识库文件上传成功")})}},resume:function(e){this.uploader.upload(e)},stop:function(e){this.uploader.stop(e)},remove:function(e){this.uploader.cancelFile(e),this.uploader.removeFile(e,!0);var t=this.fileList.findIndex(function(t){return t.id===e.id});this.fileList.splice(t,1)},fileSize:function(e){return WebUploader.Base.formatSize(e)},fileCategory:function(e){var t="",a={image:["gif","jpg","jpeg","png","bmp","webp"],video:["mp4","m3u8","rmvb","avi","swf","3gp","mkv","flv"],text:["doc","txt","docx","pages","epub","pdf","numbers","csv","xls","xlsx","keynote","ppt","pptx"]};return Object.keys(a).forEach(function(i){var n=a[i];n.indexOf(e)>-1&&(t=i)}),t}}},g=b,v=(a("0854"),Object(p["a"])(g,i,n,!1,null,"2525beb6",null));t["a"]=v.exports},4978:function(e,t,a){},"661d":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("file-uploader",{attrs:{belongs:e.belongs}}),e._v(" "),a("el-radio-group",{on:{change:e.changes},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[a("el-radio",{attrs:{label:2}},[e._v("企业文件夹2")]),e._v(" "),a("el-radio",{attrs:{label:3}},[e._v("小组文件夹1")])],1)],1)},n=[],o=a("0f1e"),l={components:{FileUploader:o["a"]},data:function(){return{radio:2,belongs:{data_type:1,ownerId:"5dafca369a301f6a9902207a",parentId:"5dafca369a301f6a9902207a",selectCompanyId:"5dafca369a301f6a9902207a"}}},methods:{changes:function(e){switch(e){case 1:this.belongs={data_type:1,ownerId:"5db92d009a301f5b3f7d906c",parentId:"5db92d009a301f5b3f7d906c",selectCompanyId:"5db92d009a301f5b3f7d906c"};break;case 2:this.belongs={data_type:1,ownerId:"5dafca369a301f6a9902207a",parentId:"5dafca369a301f6a9902207a",selectCompanyId:"5dafca369a301f6a9902207a"};break;case 3:this.belongs={data_type:2,ownerId:"295",parentId:"295",selectCompanyId:"5db985d79a301f47ede1fb5c"};break}}}},s=l,r=a("2877"),c=Object(r["a"])(s,i,n,!1,null,"0e68c5e4",null);t["default"]=c.exports},c0d7:function(e,t,a){"use strict";a.d(t,"d",function(){return l}),a.d(t,"b",function(){return s}),a.d(t,"a",function(){return r}),a.d(t,"c",function(){return c});var i=a("b775"),n=a("bc3a"),o=a.n(n);function l(e){return Object(i["a"])({url:"/system/file/upload/",method:"post",data:e})}function s(e,t){return o()({url:t+"/fileUploadCheck",method:"post",data:e})}function r(e){return Object(i["a"])({url:"/workDeskFileList/addFile",method:"post",data:e})}function c(e){return Object(i["a"])({url:"/knowledgeDirFile/createFile",method:"post",data:e})}},ec9b:function(e,t,a){},f725:function(e,t,a){"use strict";var i=a("4978"),n=a.n(i);n.a}}]);